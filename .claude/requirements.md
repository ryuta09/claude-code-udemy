# 作業時間計測アプリ 要件定義書

## 1. サービス概要

### 1.1 サービス名

Project Tracker

### 1.2 コンセプト

**「シンプルに作業時間を記録・分析できるアプリ」**

タイマー機能、カテゴリ分け、ダッシュボード表示。必要最小限の機能で、誰でも簡単に継続できる作業時間計測アプリ。

### 1.3 ターゲットユーザー

- フリーランス・個人事業主
- リモートワーカー
- 自己管理・時間管理を改善したい人
- 副業で作業時間を把握したい人

### 1.4 提供価値

- **シンプル**: 3つの機能だけで迷わない
- **継続性**: ワンクリックでタイマー開始、手軽に記録
- **可視化**: 作業時間の傾向が一目でわかる

## 2. 機能要件

### 2.1 主要機能（3つのみ）

### 機能1: 作業時間記録

- **タイマー機能**: ストップウォッチ式で計測
  - 開始ボタン
  - 停止ボタン
  - リセットボタン
- **手動入力機能**: 後から作業時間を入力可能
  - 時間・分の入力
  - カテゴリ選択（固定9種類から選択）
  - メモ入力（任意）
- 記録ボタンを押すだけで完了

### 機能2: カテゴリ管理

ユーザーが自由にカテゴリを設定可能：

- カテゴリの追加
- カテゴリの編集（名前変更）
- カテゴリの削除
- カテゴリの並び替え

※デフォルトカテゴリなし。ユーザーが必要なカテゴリを自由に作成

### 機能3: ダッシュボード

**無料版**: 合計作業時間のみ表示

- 今週の作業時間合計
- 今月の作業時間合計

**プレミアム版**: カテゴリごとの作業時間グラフ（高度な分析機能）

- 日次・週次・月次の期間切り替え
- 期間セレクター（今日/昨日、今週/先週、今月/先月）
- カテゴリ別の詳細分析
  - 円グラフ：作業時間割合の可視化
  - 棒グラフ：カテゴリ別作業時間の比較
  - トレンドライン：作業時間傾向の把握（日次のみ）

### 2.2 必須機能（主要機能を支える最小限の機能）

### ユーザー認証

- メールアドレスでのログイン（ソーシャルログインには未対応）
- パスワードリセット
- セッション管理

### データ管理

- 作業履歴の閲覧
- 作業データの編集
- 作業データの削除
- カテゴリの追加・編集・削除・並び替え

## 3. 非機能要件

### 3.1 パフォーマンス

- 作業時間記録：1秒以内で完了
- タイマー：リアルタイムで正確に動作
- シンプルで軽量な動作

### 3.2 ユーザビリティ

- スマートフォン最適化（レスポンシブデザイン）
- 最小ステップで作業記録完了（タイマー停止→カテゴリ選択→記録、または手動入力→記録）
- 直感的で説明不要なUI
- 共通ヘッダーによるナビゲーション

### 3.3 セキュリティ

- ユーザーデータの安全な管理
- HTTPS通信

## 4. 期間分析機能の詳細仕様

### 4.1 期間切り替えUI

- **タブ切り替え**
  - 日次 / 週次 / 月次をタブで切り替え
  - アクティブタブはグラデーション背景
  - スムーズなトランジションアニメーション

### 4.2 期間セレクター

- **日次**
  - 今日 / 昨日
  - カレンダーピッカーで任意の日付選択可能

- **週次**
  - 今週 / 先週
  - 週の開始は月曜日
  - カスタム期間選択可能

- **月次**
  - 今月 / 先月
  - 年月ピッカーで任意の月選択可能

### 4.3 比較機能

- 選択した期間と前期間の比較
- 増減率の表示（％表示）
- 増減をカラーコーディング（増加:緑、減少:赤）
  - ※作業時間の場合、増加はポジティブ（緑）、減少はネガティブ（赤）

### 4.4 データ表示

- **サマリーカード**
  - 期間内の総作業時間
  - 前期間比較
  - 1日平均作業時間
  - 最も作業時間が多いカテゴリ

- **詳細グラフ**
  - 日次：時系列折れ線グラフ
  - 週次：日別積み上げ棒グラフ
  - 月次：週別トレンドライン

## 5. 技術仕様

- **フロントエンド**: Next.js 16、TypeScript、Tailwind CSS、Shadcn UI
- **バックエンド**: Next.js API Routes
- **データベース**: Supabase（PostgreSQL）
  - ローカルは Supabase CLI にて検証（Dockerは未使用）
- **認証**: Clerk（Clerkダッシュボードからキーを取得する必要あり）
- **課金システム**: Clerk Billing（Stripe連携が必要、開発後半で実装）
- **グラフライブラリ**: Recharts（プレミアム機能で使用）
- **日時処理**: date-fns, date-fns-tz
- **ホスティング**: Vercel
- **その他**:
    - フォーム：react-hook-form
    - アイコン: lucide-react
    - Lint: ESLint, Prettier
- **テスト**: MVP目的のためテストは書かない

### 5.1 データモデル

#### categories テーブル

| カラム名 | 型 | 説明 |
|---------|------|------|
| id | UUID | 主キー |
| user_id | TEXT | Clerk ユーザーID |
| name | TEXT | カテゴリ名 |
| sort_order | INTEGER | 並び順 |
| created_at | TIMESTAMPTZ | 作成日時 |
| updated_at | TIMESTAMPTZ | 更新日時 |

#### work_logs テーブル

| カラム名 | 型 | 説明 |
|---------|------|------|
| id | UUID | 主キー |
| user_id | TEXT | Clerk ユーザーID |
| category_id | UUID | カテゴリID（外部キー） |
| duration | INTEGER | 作業時間（秒単位） |
| memo | TEXT (nullable) | メモ |
| started_at | TIMESTAMPTZ (nullable) | タイマー開始時刻（タイマー使用時） |
| created_at | TIMESTAMPTZ | 作成日時 |
| updated_at | TIMESTAMPTZ | 更新日時 |

### 5.2 タイマー機能の実装

- React の useState と useEffect でタイマー状態を管理
- setInterval を使用して1秒ごとにカウントアップ
- ブラウザタブを閉じても時間が失われないよう、開始時刻を localStorage に保存
- タイマー状態: idle（初期）→ running（計測中）→ paused（一時停止）→ idle（リセット）

### 開発時の注意事項
- Clerk Billingは標準のnpmパッケージではなく、Clerkダッシュボードでの設定が必要
- Clerkダッシュボードでプランを作成する際は、スラグを「premium」に設定
- SupabaseとClerkの認証連携では、カスタムヘッダー方式でRLSを実装
- Supabaseローカル開発時はポート競合に注意（`supabase stop --all`で解決）
- Supabaseでユーザーテーブルを作る場合でも、ClerkのWebhook機能は使用しない
  - usersテーブルなどが必要であれば、初回データ登録時に作成する
- プレミアム機能はClerkのhas()関数でプラン確認を行う

## 6. 画面構成

### 6.1 公開ページ

- **トップページ** (`/`): サービス紹介、機能説明、料金プラン
- **料金ページ** (`/pricing`): Clerk BillingのPricingTableを表示
- **サインイン** (`/sign-in`): Clerkのサインインコンポーネント
- **サインアップ** (`/sign-up`): Clerkのサインアップコンポーネント

### 6.2 認証必須ページ

- **ダッシュボード** (`/dashboard`): メイン画面、タイマーと作業記録・分析を表示
- **カテゴリ管理** (`/categories`): カテゴリの追加・編集・削除・並び替え
- **ユーザー設定** (`/user-setting`): Clerkのアカウント管理コンポーネント

### 6.3 共通コンポーネント

- **ヘッダー**: ロゴ、ナビゲーション、ユーザーメニュー
- **フッター**: コピーライト表示（トップページのみ）

## 7 料金体系

### 7.1 無料プラン

- 作業時間記録（無制限）
- タイマー機能
- 手動入力機能
- 週次・月次の合計時間表示
- 作業履歴閲覧

### 7.2 プレミアムプラン

- 月額: $10（ドル表記）
- **高度な分析機能**
  - 日次・週次・月次の期間切り替え
  - 過去データとの比較（昨日/先週/先月）
  - カテゴリ別の詳細グラフ（円グラフ・棒グラフ）
  - 作業時間トレンドの可視化
- **デザイン**
  - プレミアム感のあるUI
  - アニメーション効果
  - 高級感のあるグラデーション
- 無料プランの全機能含む
